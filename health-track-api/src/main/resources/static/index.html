<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perca Peso - Sistema de Acompanhamento de Sa√∫de</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* P√°gina de Login/Cadastro */
        #authPage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 90vh;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 450px;
            width: 100%;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: #dc143c;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: #333;
            font-size: 1.1em;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #dc143c;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .message {
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: none;
            animation: slideIn 0.3s;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        /* Dashboard */
        #dashboardPage {
            display: none;
        }

        .dashboard-header {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(220, 20, 60, 0.3);
            border: 1px solid #dc143c;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h2 {
            color: #dc143c;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #cccccc;
        }

        .logout-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(220, 20, 60, 0.3);
            border: 1px solid #333;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #dc143c;
        }

        .card h3 {
            color: #dc143c;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* M√©tricas de Sa√∫de */
        .health-metric {
            position: relative;
            cursor: help;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #dc143c;
            margin: 10px 0;
        }

        .metric-label {
            color: #cccccc;
            font-size: 1.1em;
            border-bottom: 2px dotted #dc143c;
            display: inline-block;
        }

        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            line-height: 1.6;
            width: 300px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 10px;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #333;
        }

        .health-metric:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Sistema de Recompensas */
        .rewards-container {
            background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .nivel-display {
            text-align: center;
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .nivel-numero {
            font-size: 3.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .nivel-titulo {
            font-size: 1.3em;
            margin-bottom: 15px;
            opacity: 0.95;
        }

        .xp-bar-container {
            background: rgba(0,0,0,0.3);
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-top: 10px;
        }

        .xp-bar-fill {
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: bold;
            color: #333;
        }

        .rewards-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .reward-stat {
            text-align: center;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .reward-stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .reward-stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .conquistas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .conquista {
            background: rgba(255,255,255,0.2);
            padding: 15px 10px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
        }

        .conquista-icone {
            font-size: 2.5em;
            margin-bottom: 8px;
            display: block;
        }

        .conquista-nome {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .conquista-progresso {
            font-size: 0.75em;
            opacity: 0.9;
        }

        .conquista-bar {
            background: rgba(0,0,0,0.3);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .conquista-bar-fill {
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            height: 100%;
            transition: width 0.5s ease;
        }

        .conquista:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .conquista.locked {
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .conquista.desbloqueada {
            border-color: #ffd700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }
            50% {
                box-shadow: 0 0 20px 10px rgba(255, 215, 0, 0);
            }
        }

        /* Notifica√ß√£o de Conquista */
        .conquista-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.5);
            z-index: 10000;
            animation: slideIn 0.5s ease, confetti 0.5s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .conquista-notification-icon {
            font-size: 3em;
            text-align: center;
            margin-bottom: 10px;
        }

        .conquista-notification-title {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }

        .conquista-notification-desc {
            text-align: center;
            font-size: 0.95em;
        }

        /* Tarefas Checklist */
        .tasks-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .task-item {
            background: #0a0a0a;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            border-left: 4px solid #dc143c;
            border: 1px solid #333;
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            border-left-color: #8b0000;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .task-category {
            display: inline-block;
            padding: 4px 12px;
            background: #dc143c;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 10px;
        }

        .task-points {
            color: #dc143c;
            font-weight: bold;
        }

        /* Hist√≥rico de Peso */
        .weight-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .weight-entry {
            background: #0a0a0a;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #333;
        }

        .weight-date {
            color: #dc143c;
            font-weight: 600;
        }

        .weight-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffffff;
        }

        .weight-change {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .weight-change.positive {
            background: #1a4d1a;
            color: #90ee90;
        }

        .weight-change.negative {
            background: #4d1a1a;
            color: #ff6b6b;
        }

        /* Visualiza√ß√£o Corporal */
        .body-visualization {
            padding: 20px;
            text-align: center;
        }

        .body-stats {
            margin-bottom: 25px;
        }

        .body-stat-item {
            margin-bottom: 15px;
        }

        .body-stat-label {
            font-size: 0.9em;
            color: #999;
            margin-bottom: 8px;
        }

        .body-stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #dc143c 0%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .body-stat-category {
            font-size: 1.1em;
            color: #ffffff;
            padding: 8px 20px;
            background: rgba(220, 20, 60, 0.2);
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .body-canvas-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto;
            display: inline-block;
            border: 2px solid #333;
            box-shadow: 0 8px 32px rgba(220, 20, 60, 0.1);
        }

        #bodyCanvas {
            display: block;
            margin: 0 auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .body-info {
            margin-top: 15px;
        }

        /* Formul√°rio de Registro */
        .quick-register {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .add-task-form {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }   margin-bottom: 20px;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .rewards-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Progress bar */
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc143c 0%, #8b0000 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85em;
            font-weight: bold;
        }   font-weight: bold;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .stat-comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item-label {
            font-size: 0.85em;
            color: #cccccc;
            margin-bottom: 5px;
        }

        .stat-item-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #dc143c;
        }
    </style>
</head>
<body>
    <!-- P√°gina de Autentica√ß√£o -->
    <div id="authPage">
        <div class="auth-container">
            <div class="auth-header">
                <h1>üèÉ‚Äç‚ôÇÔ∏è Perca Peso</h1>
                <p>Seu companheiro de sa√∫de e bem-estar</p>
            </div>

            <div id="authMessage" class="message"></div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login')">Login</button>
                <button class="auth-tab" onclick="switchTab('cadastro')">Cadastro</button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="auth-form active" onsubmit="fazerLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="loginSenha" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
            </form>

            <!-- Formul√°rio de Cadastro -->
            <form id="cadastroForm" class="auth-form" onsubmit="fazerCadastro(event)">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="cadastroNome" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="cadastroEmail" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="cadastroSenha" required>
                </div>
                <div class="form-group">
                    <label>Data de Nascimento</label>
                    <input type="date" id="cadastroDataNascimento" required>
                </div>
                <div class="form-group">
                    <label>G√™nero</label>
                    <select id="cadastroGenero" required>
                        <option value="">Selecione</option>
                        <option value="MASCULINO">Masculino</option>
                        <option value="FEMININO">Feminino</option>
                        <option value="OUTRO">Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Altura (metros)</label>
                    <input type="number" step="0.01" id="cadastroAltura" placeholder="Ex: 1.75" required>
                </div>
                <div class="form-group">
                    <label>Peso Atual (kg)</label>
                    <input type="number" step="0.1" id="cadastroPeso" placeholder="Ex: 75.5" required>
                </div>
                <div class="form-group">
                    <label>Peso Meta (kg)</label>
                    <input type="number" step="0.1" id="cadastroPesoMeta" placeholder="Ex: 70.0">
                </div>
                <button type="submit" class="btn">Criar Conta</button>
            </form>
        </div>
    </div>

    <!-- Dashboard do Usu√°rio -->
    <div id="dashboardPage">
        <div class="container">
            <!-- Cabe√ßalho -->
            <div class="dashboard-header">
                <div class="user-info">
                    <h2 id="dashboardUserName">Bem-vindo!</h2>
                    <p id="dashboardUserEmail"></p>
                </div>
                <button class="logout-btn" onclick="fazerLogout()">Sair</button>
            </div>

            <!-- Sistema de Recompensas -->
            <div class="card">
                <h3>üèÜ Sistema de Recompensas</h3>
                <div class="rewards-container">
                    <!-- N√≠vel e XP -->
                    <div class="nivel-display">
                        <div class="nivel-numero">N√≠vel <span id="nivelAtual">1</span></div>
                        <div class="nivel-titulo" id="nivelTitulo">Iniciante üå±</div>
                        <div style="font-size: 0.95em; opacity: 0.9;">
                            <span id="xpAtual">0</span> XP
                        </div>
                        <div class="xp-bar-container">
                            <div class="xp-bar-fill" id="xpBar" style="width: 0%">
                                0%
                            </div>
                        </div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 8px;">
                            Pr√≥ximo n√≠vel: <span id="xpProximoNivel">100</span> XP
                        </div>
                    </div>

                    <!-- Estat√≠sticas -->
                    <div class="rewards-stats">
                        <div class="reward-stat">
                            <div class="reward-stat-value" id="pontosTotal">0</div>
                            <div class="reward-stat-label">üí∞ Pontos</div>
                        </div>
                        <div class="reward-stat">
                            <div class="reward-stat-value" id="diasConsecutivos">0</div>
                            <div class="reward-stat-label">üî• Streak</div>
                        </div>
                        <div class="reward-stat">
                            <div class="reward-stat-value" id="recordeStreak">0</div>
                            <div class="reward-stat-label">üèÖ Recorde</div>
                        </div>
                        <div class="reward-stat">
                            <div class="reward-stat-value" id="conquistasTotal">0/10</div>
                            <div class="reward-stat-label">üéØ Conquistas</div>
                        </div>
                    </div>

                    <!-- Multiplicador -->
                    <div style="text-align: center; background: rgba(255,255,255,0.15); padding: 12px; border-radius: 10px; margin-bottom: 20px; font-size: 1.1em;">
                        <span style="opacity: 0.9;">Multiplicador: </span>
                        <span id="multiplicadorAtual" style="font-weight: bold; font-size: 1.3em;">1.0x</span>
                        <span style="opacity: 0.8; font-size: 0.9em; margin-left: 10px;">‚ö°</span>
                    </div>

                    <h4 style="margin-bottom: 15px; opacity: 0.9; font-size: 1.2em;">üéñÔ∏è Conquistas</h4>
                    <div class="conquistas-grid" id="conquistasGrid">
                        <!-- Conquistas ser√£o carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Grid Principal -->
            <div class="dashboard-grid">
                <!-- M√©tricas de Sa√∫de -->
                <div class="card">
                    <h3>üìä M√©tricas de Sa√∫de</h3>
                    
                    <div class="health-metric">
                        <div class="metric-label">IMC (√çndice de Massa Corporal)</div>
                        <div class="metric-value" id="imcValue">--</div>
                        <div class="tooltip">
                            <strong>IMC - √çndice de Massa Corporal</strong><br>
                            √â uma medida que relaciona seu peso e altura.<br><br>
                            <strong>Classifica√ß√£o:</strong><br>
                            ‚Ä¢ Abaixo de 18.5: Abaixo do peso<br>
                            ‚Ä¢ 18.5 - 24.9: Peso normal<br>
                            ‚Ä¢ 25.0 - 29.9: Sobrepeso<br>
                            ‚Ä¢ Acima de 30: Obesidade
                        </div>
                    </div>

                    <div class="health-metric" style="margin-top: 30px;">
                        <div class="metric-label">TMB (Taxa Metab√≥lica Basal)</div>
                        <div class="metric-value" id="tmbValue">--</div>
                        <div class="tooltip">
                            <strong>TMB - Taxa Metab√≥lica Basal</strong><br>
                            √â a quantidade de calorias que seu corpo precisa em repouso para manter fun√ß√µes vitais.<br><br>
                            √ötil para planejar sua dieta e atingir suas metas de peso!
                        </div>
                    </div>

                    <div class="stat-comparison">
                        <div class="stat-item">
                            <div class="stat-item-label">Peso Inicial</div>
                            <div class="stat-item-value" id="pesoInicialDisplay">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">Peso Atual</div>
                            <div class="stat-item-value" id="pesoAtualDisplay">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">Peso Meta</div>
                            <div class="stat-item-value" id="pesoMetaDisplay">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-item-label">Progresso</div>
                            <div class="stat-item-value" id="progressoPercentual" style="color: #dc143c;">--</div>
                        </div>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progressoPeso" style="width: 0%">0%</div>
                    </div>
                </div>

                <!-- Visualiza√ß√£o Corporal -->
                <div class="card">
                    <h3>üë§ Composi√ß√£o Corporal</h3>
                    
                    <div class="body-visualization">
                        <div class="body-stats">
                            <div class="body-stat-item">
                                <div class="body-stat-label">Gordura Corporal</div>
                                <div class="body-stat-value" id="percentualGorduraDisplay">--</div>
                            </div>
                            <div class="body-stat-category" id="categoriaGordura">
                                Calculando...
                            </div>
                        </div>
                        
                        <div class="body-canvas-container">
                            <canvas id="bodyCanvas" width="220" height="420"></canvas>
                        </div>
                        
                        <div class="body-info">
                            <p style="font-size: 0.85em; color: #666; text-align: center; margin-top: 15px;">
                                Representa√ß√£o visual baseada no percentual de gordura corporal estimado pela f√≥rmula de Deurenberg.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tarefas do Dia -->
                <div class="card">
                    <h3>‚úÖ Tarefas de Hoje</h3>
                    
                    <div class="add-task-form">
                        <div class="form-group">
                            <input type="text" id="novaTarefaTitulo" placeholder="Nome da tarefa...">
                        </div>
                        <div class="form-group">
                            <input type="text" id="novaTarefaDescricao" placeholder="Descri√ß√£o (opcional)...">
                        </div>
                        <div class="form-row">
                            <select id="novaTarefaCategoria">
                                <option value="EXERCICIO">Exerc√≠cio</option>
                                <option value="ALIMENTACAO">Alimenta√ß√£o</option>
                                <option value="HIDRATACAO">Hidrata√ß√£o</option>
                                <option value="SONO">Sono</option>
                                <option value="OUTRO">Outro</option>
                            </select>
                            <select id="novaTarefaDificuldade">
                                <option value="FACIL">F√°cil (+10pts)</option>
                                <option value="MEDIO">M√©dio (+25pts)</option>
                                <option value="DIFICIL">Dif√≠cil (+50pts)</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <select id="novaTarefaFrequencia" onchange="mostrarDiasSemana()">
                                <option value="UNICA">Tarefa √önica</option>
                                <option value="DIARIA">Di√°ria</option>
                                <option value="SEMANAL">Semanal</option>
                            </select>
                        </div>
                        <div class="form-group" id="diasSemanaContainer" style="display: none;">
                            <label style="font-size: 0.9em; margin-bottom: 10px;">Selecione os dias:</label>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="MONDAY" class="dia-checkbox"> Seg
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="TUESDAY" class="dia-checkbox"> Ter
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="WEDNESDAY" class="dia-checkbox"> Qua
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="THURSDAY" class="dia-checkbox"> Qui
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="FRIDAY" class="dia-checkbox"> Sex
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="SATURDAY" class="dia-checkbox"> S√°b
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9em;">
                                    <input type="checkbox" value="SUNDAY" class="dia-checkbox"> Dom
                                </label>
                            </div>
                        </div>
                        <button class="btn" onclick="adicionarTarefa()">Adicionar Tarefa</button>
                    </div>

                    <div class="tasks-list" id="tasksList">
                        <p style="text-align: center; color: #999;">Nenhuma tarefa para hoje</p>
                    </div>
                </div>

                <!-- Registro de Peso -->
                <div class="card">
                    <h3>‚öñÔ∏è Hist√≥rico de Peso</h3>
                    
                    <div class="quick-register">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Peso (kg)</label>
                                <input type="number" step="0.1" id="novoPeso" placeholder="Ex: 75.5">
                            </div>
                            <div class="form-group" style="display: flex; align-items: flex-end;">
                                <button class="btn" type="button" onclick="registrarPeso(); return false;">Registrar</button>
                            </div>
                        </div>
                    </div>

                    <div class="weight-history" id="weightHistory">
                        <p style="text-align: center; color: #999;">Nenhum registro ainda</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let usuarioAtual = null;

        // Alternar entre abas de Login e Cadastro
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.auth-tab');
            const forms = document.querySelectorAll('.auth-form');
            
            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                tabs[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('cadastroForm').classList.add('active');
            }
            
            hideMessage('authMessage');
        }

        // Fazer Login
        async function fazerLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const senha = document.getElementById('loginSenha').value;

            try {
                const response = await fetch(`${API_URL}/usuarios/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, senha })
                });

                const data = await response.json();

                if (data.sucesso) {
                    usuarioAtual = data.usuario;
                    localStorage.setItem('usuarioId', usuarioAtual.id);
                    mostrarDashboard();
                } else {
                    showMessage('authMessage', '‚ùå ' + data.mensagem, 'error');
                }
            } catch (error) {
                showMessage('authMessage', '‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        }

        // Fazer Cadastro
        async function fazerCadastro(event) {
            event.preventDefault();
            
            const usuario = {
                nome: document.getElementById('cadastroNome').value,
                email: document.getElementById('cadastroEmail').value,
                senha: document.getElementById('cadastroSenha').value,
                dataNascimento: document.getElementById('cadastroDataNascimento').value,
                genero: document.getElementById('cadastroGenero').value,
                altura: parseFloat(document.getElementById('cadastroAltura').value),
                pesoAtual: parseFloat(document.getElementById('cadastroPeso').value),
                pesoMeta: parseFloat(document.getElementById('cadastroPesoMeta').value) || null
            };

            try {
                const response = await fetch(`${API_URL}/usuarios`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(usuario)
                });

                if (response.ok) {
                    const usuarioCriado = await response.json();
                    showMessage('authMessage', '‚úÖ Conta criada com sucesso! Fa√ßa login.', 'success');
                    
                    // Limpar formul√°rio e voltar para login
                    document.getElementById('cadastroForm').reset();
                    setTimeout(() => {
                        switchTab('login');
                        document.getElementById('loginEmail').value = usuario.email;
                    }, 2000);
                } else {
                    showMessage('authMessage', '‚ùå Erro ao criar conta. Email j√° cadastrado?', 'error');
                }
            } catch (error) {
                showMessage('authMessage', '‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        }

        // Mostrar Dashboard
        async function mostrarDashboard() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            
            // Atualizar informa√ß√µes do usu√°rio
            document.getElementById('dashboardUserName').textContent = `Ol√°, ${usuarioAtual.nome}! üëã`;
            document.getElementById('dashboardUserEmail').textContent = usuarioAtual.email;
            
            // Atualizar m√©tricas
            document.getElementById('imcValue').textContent = usuarioAtual.imc ? usuarioAtual.imc.toFixed(1) : '--';
            document.getElementById('tmbValue').textContent = usuarioAtual.tmb ? usuarioAtual.tmb.toFixed(0) + ' kcal' : '--';
            
            // Usar peso inicial do usu√°rio (campo fixo)
            const pesoInicial = usuarioAtual.pesoInicial || usuarioAtual.pesoAtual;
            
            document.getElementById('pesoInicialDisplay').textContent = pesoInicial.toFixed(1) + ' kg';
            document.getElementById('pesoAtualDisplay').textContent = usuarioAtual.pesoAtual.toFixed(1) + ' kg';
            document.getElementById('pesoMetaDisplay').textContent = (usuarioAtual.pesoMeta || '--') + ' kg';
            
            // Calcular progresso em rela√ß√£o √† meta
            if (usuarioAtual.pesoMeta && usuarioAtual.pesoAtual && pesoInicial) {
                const diferencaTotal = Math.abs(pesoInicial - usuarioAtual.pesoMeta);
                const diferencaAtual = Math.abs(pesoInicial - usuarioAtual.pesoAtual);
                const porcentagem = diferencaTotal > 0 ? (diferencaAtual / diferencaTotal) * 100 : 0;
                const progressoFinal = Math.min(100, Math.max(0, porcentagem));
                
                document.getElementById('progressoPeso').style.width = progressoFinal + '%';
                document.getElementById('progressoPeso').textContent = progressoFinal.toFixed(1) + '%';
                document.getElementById('progressoPercentual').textContent = progressoFinal.toFixed(1) + '%';
            }
            
            // Atualizar recompensas
            if (usuarioAtual.sistemaRecompensas) {
                const recompensas = usuarioAtual.sistemaRecompensas;
                
                // N√≠vel e XP
                document.getElementById('nivelAtual').textContent = recompensas.nivel || 1;
                document.getElementById('nivelTitulo').textContent = obterTituloNivel(recompensas.nivel || 1);
                document.getElementById('xpAtual').textContent = recompensas.experiencia || 0;
                
                const xpProximoNivel = Math.pow((recompensas.nivel || 1), 2) * 100;
                const xpNivelAtual = Math.pow((recompensas.nivel || 1) - 1, 2) * 100;
                const xpProgresso = (recompensas.experiencia || 0) - xpNivelAtual;
                const xpNecessario = xpProximoNivel - xpNivelAtual;
                const porcentagemXP = Math.min(100, (xpProgresso / xpNecessario) * 100);
                
                document.getElementById('xpBar').style.width = porcentagemXP + '%';
                document.getElementById('xpBar').textContent = Math.round(porcentagemXP) + '%';
                document.getElementById('xpProximoNivel').textContent = xpProximoNivel;
                
                // Estat√≠sticas
                document.getElementById('pontosTotal').textContent = recompensas.pontos || 0;
                document.getElementById('diasConsecutivos').textContent = recompensas.diasConsecutivos || 0;
                document.getElementById('recordeStreak').textContent = recompensas.recordeStreak || 0;
                
                // Multiplicador
                const multiplicador = obterMultiplicador(recompensas.diasConsecutivos || 0);
                document.getElementById('multiplicadorAtual').textContent = multiplicador.toFixed(1) + 'x';
                
                // Atualizar conquistas
                atualizarConquistas(recompensas.conquistas || []);
            }
            
            // Atualizar visualiza√ß√£o corporal
            atualizarVisualizacaoCorporal();
            
            // Carregar tarefas
            await carregarTarefas();
            
            // Carregar hist√≥rico de peso
            await carregarHistoricoPeso();
        }

        function obterTituloNivel(nivel) {
            if (nivel >= 20) return "Lenda üëë";
            if (nivel >= 15) return "Mestre üèÜ";
            if (nivel >= 10) return "Dedicado üí™";
            if (nivel >= 5) return "Comprometido ‚≠ê";
            return "Iniciante üå±";
        }

        function obterMultiplicador(streak) {
            if (streak >= 30) return 3.0;
            if (streak >= 14) return 2.0;
            if (streak >= 7) return 1.5;
            return 1.0;
        }

        function atualizarConquistas(conquistas) {
            const conquistasGrid = document.getElementById('conquistasGrid');
            conquistasGrid.innerHTML = '';
            
            const totalConquistas = conquistas.length;
            const conquistasDesbloqueadas = conquistas.filter(c => c.desbloqueada).length;
            document.getElementById('conquistasTotal').textContent = conquistasDesbloqueadas + '/' + totalConquistas;
            
            conquistas.forEach(conquista => {
                const div = document.createElement('div');
                div.className = 'conquista' + (conquista.desbloqueada ? ' desbloqueada' : ' locked');
                
                const porcentagem = Math.min(100, (conquista.progresso / conquista.meta) * 100);
                
                div.innerHTML = `
                    <span class="conquista-icone">${conquista.icone}</span>
                    <div class="conquista-nome">${conquista.nome}</div>
                    <div class="conquista-progresso">${conquista.progresso}/${conquista.meta}</div>
                    <div class="conquista-bar">
                        <div class="conquista-bar-fill" style="width: ${porcentagem}%"></div>
                    </div>
                `;
                
                div.title = conquista.descricao + (conquista.desbloqueada ? '\n‚úÖ Desbloqueada!' : '');
                
                // Verificar se foi rec√©m desbloqueada
                if (conquista.desbloqueada && conquista.progresso === conquista.meta) {
                    mostrarNotificacaoConquista(conquista);
                }
                
                conquistasGrid.appendChild(div);
            });
        }

        function mostrarNotificacaoConquista(conquista) {
            // Verificar se j√° foi mostrada
            const chave = 'conquista_mostrada_' + conquista.id;
            if (localStorage.getItem(chave)) return;
            
            const notificacao = document.createElement('div');
            notificacao.className = 'conquista-notification';
            notificacao.innerHTML = `
                <div class="conquista-notification-icon">${conquista.icone}</div>
                <div class="conquista-notification-title">üéâ Conquista Desbloqueada!</div>
                <div class="conquista-notification-desc">${conquista.nome}</div>
            `;
            
            document.body.appendChild(notificacao);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                notificacao.style.animation = 'slideIn 0.5s ease reverse';
                setTimeout(() => notificacao.remove(), 500);
            }, 5000);
            
            // Marcar como mostrada
            localStorage.setItem(chave, 'true');
        }

        async function carregarDashboard() {
            if (!usuarioAtual) return;
            
            // Carregar tarefas
            await carregarTarefas();
            
            // Carregar hist√≥rico de peso
            await carregarHistoricoPeso();
        }

        // Mostrar/Esconder sele√ß√£o de dias da semana
        function mostrarDiasSemana() {
            const frequencia = document.getElementById('novaTarefaFrequencia').value;
            const container = document.getElementById('diasSemanaContainer');
            container.style.display = frequencia === 'SEMANAL' ? 'block' : 'none';
        }

        // Carregar Tarefas
        async function carregarTarefas() {
            try {
                const response = await fetch(`${API_URL}/tarefas/usuario/${usuarioAtual.id}/hoje`);
                const tarefasHoje = await response.json();
                
                const tasksList = document.getElementById('tasksList');
                tasksList.innerHTML = '';
                
                if (tarefasHoje.length === 0) {
                    tasksList.innerHTML = '<p style="text-align: center; color: #999;">Nenhuma tarefa para hoje</p>';
                    return;
                }
                
                tarefasHoje.forEach(tarefa => {
                    const concluidaHoje = tarefa.conclusoesPorData && tarefa.conclusoesPorData[new Date().toISOString().split('T')[0]];
                    const pontos = tarefa.dificuldade === 'FACIL' ? 10 : tarefa.dificuldade === 'MEDIO' ? 25 : 50;
                    
                    const div = document.createElement('div');
                    div.className = 'task-item' + (concluidaHoje ? ' completed' : '');
                    
                    let frequenciaTexto = '';
                    if (tarefa.frequencia === 'DIARIA') {
                        frequenciaTexto = 'üîÑ Di√°ria';
                    } else if (tarefa.frequencia === 'SEMANAL') {
                        const diasMap = {
                            'MONDAY': 'Seg', 'TUESDAY': 'Ter', 'WEDNESDAY': 'Qua',
                            'THURSDAY': 'Qui', 'FRIDAY': 'Sex', 'SATURDAY': 'S√°b', 'SUNDAY': 'Dom'
                        };
                        const dias = tarefa.diasDaSemana.map(d => diasMap[d]).join(', ');
                        frequenciaTexto = `üìÖ ${dias}`;
                    }
                    
                    div.innerHTML = `
                        <input type="checkbox" class="task-checkbox" 
                               ${concluidaHoje ? 'checked' : ''} 
                               onchange="toggleTarefaHoje(${tarefa.id}, this.checked)">
                        <div class="task-content">
                            <div class="task-title">${tarefa.titulo}</div>
                            ${tarefa.descricao ? `<div style="font-size: 0.85em; color: #999; margin: 5px 0;">${tarefa.descricao}</div>` : ''}
                            <div style="margin-top: 8px;">
                                <span class="task-category">${tarefa.categoria || 'Geral'}</span>
                                ${frequenciaTexto ? `<span style="font-size: 0.85em; color: #999; margin-left: 10px;">${frequenciaTexto}</span>` : ''}
                                ${!concluidaHoje ? `<span class="task-points">+${pontos} pontos</span>` : ''}
                            </div>
                        </div>
                        <button onclick="removerTarefa(${tarefa.id})" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-left: 10px;">üóëÔ∏è</button>
                    `;
                    tasksList.appendChild(div);
                });
            } catch (error) {
                console.error('Erro ao carregar tarefas:', error);
            }
        }

        // Adicionar Tarefa
        async function adicionarTarefa() {
            const titulo = document.getElementById('novaTarefaTitulo').value;
            const descricao = document.getElementById('novaTarefaDescricao').value;
            const categoria = document.getElementById('novaTarefaCategoria').value;
            const dificuldade = document.getElementById('novaTarefaDificuldade').value;
            const frequencia = document.getElementById('novaTarefaFrequencia').value;
            
            if (!titulo) {
                alert('Por favor, insira o nome da tarefa!');
                return;
            }
            
            const diasDaSemana = [];
            if (frequencia === 'SEMANAL') {
                const checkboxes = document.querySelectorAll('.dia-checkbox:checked');
                if (checkboxes.length === 0) {
                    alert('Por favor, selecione pelo menos um dia da semana!');
                    return;
                }
                checkboxes.forEach(cb => diasDaSemana.push(cb.value));
            }
            
            try {
                const response = await fetch(`${API_URL}/tarefas`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        usuarioId: usuarioAtual.id,
                        titulo,
                        descricao,
                        categoria,
                        dificuldade,
                        frequencia,
                        diasDaSemana,
                        concluida: false,
                        conclusoesPorData: {},
                        dataHora: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    document.getElementById('novaTarefaTitulo').value = '';
                    document.getElementById('novaTarefaDescricao').value = '';
                    document.getElementById('novaTarefaFrequencia').value = 'UNICA';
                    document.querySelectorAll('.dia-checkbox').forEach(cb => cb.checked = false);
                    mostrarDiasSemana();
                    await carregarTarefas();
                }
            } catch (error) {
                console.error('Erro ao adicionar tarefa:', error);
            }
        }

        // Toggle Tarefa Hoje
        async function toggleTarefaHoje(tarefaId, concluida) {
            try {
                const endpoint = concluida ? 'concluir-hoje' : 'desconcluir-hoje';
                const response = await fetch(`${API_URL}/tarefas/${tarefaId}/${endpoint}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    // Recarregar usu√°rio para atualizar pontos
                    const userResponse = await fetch(`${API_URL}/usuarios/${usuarioAtual.id}`);
                    if (userResponse.ok) {
                        usuarioAtual = await userResponse.json();
                        
                        // Atualizar todas as recompensas (XP, pontos, n√≠vel, conquistas)
                        atualizarRecompensasInterface();
                    }
                    
                    await carregarTarefas();
                }
            } catch (error) {
                console.error('Erro ao atualizar tarefa:', error);
            }
        }

        // Remover Tarefa
        async function removerTarefa(tarefaId) {
            if (!confirm('Deseja realmente remover esta tarefa?')) return;
            
            try {
                console.log('Removendo tarefa ID:', tarefaId);
                const response = await fetch(`${API_URL}/tarefas/${tarefaId}`, {
                    method: 'DELETE'
                });
                
                console.log('Status da resposta:', response.status);
                
                if (response.ok || response.status === 204) {
                    // Recarregar usu√°rio para atualizar recompensas
                    const userResponse = await fetch(`${API_URL}/usuarios/${usuarioAtual.id}`);
                    if (userResponse.ok) {
                        usuarioAtual = await userResponse.json();
                        atualizarRecompensasInterface();
                    }
                    
                    alert('‚úÖ Tarefa removida com sucesso!');
                    await carregarTarefas();
                } else {
                    const errorText = await response.text();
                    console.error('Erro ao remover:', errorText);
                    alert('‚ùå Erro ao remover tarefa: ' + (errorText || 'Erro desconhecido'));
                }
            } catch (error) {
                console.error('Erro ao remover tarefa:', error);
                alert('‚ùå Erro ao remover tarefa: ' + error.message);
            }
        }

        // Carregar Hist√≥rico de Peso
        async function carregarHistoricoPeso() {
            try {
                const response = await fetch(`${API_URL}/registros-diarios/usuario/${usuarioAtual.id}`);
                const registrosUsuario = await response.json();
                
                // Filtrar apenas registros com peso e ordenar
                const registrosComPeso = registrosUsuario
                    .filter(r => r.peso)
                    .sort((a, b) => new Date(b.data) - new Date(a.data));
                
                const weightHistory = document.getElementById('weightHistory');
                weightHistory.innerHTML = '';
                
                if (registrosComPeso.length === 0) {
                    weightHistory.innerHTML = '<p style="text-align: center; color: #999;">Nenhum registro ainda</p>';
                    return;
                }
                
                registrosComPeso.forEach((registro, index) => {
                    const div = document.createElement('div');
                    div.className = 'weight-entry';
                    
                    let changeHtml = '';
                    if (index < registrosComPeso.length - 1) {
                        const pesoAnterior = registrosComPeso[index + 1].peso;
                        const diferenca = registro.peso - pesoAnterior;
                        const sinal = diferenca > 0 ? '+' : '';
                        const classe = diferenca > 0 ? 'negative' : 'positive';
                        changeHtml = `<span class="weight-change ${classe}">${sinal}${diferenca.toFixed(1)} kg</span>`;
                    }
                    
                    div.innerHTML = `
                        <span class="weight-date">${new Date(registro.data).toLocaleDateString('pt-BR')}</span>
                        <span class="weight-value">${registro.peso} kg</span>
                        ${changeHtml}
                    `;
                    weightHistory.appendChild(div);
                });
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
        }

        // Registrar Peso
        async function registrarPeso() {
            console.log('üîµ Fun√ß√£o registrarPeso() foi chamada!');
            const pesoInput = document.getElementById('novoPeso');
            console.log('üîµ Input encontrado:', pesoInput);
            const peso = parseFloat(pesoInput.value);
            console.log('üîµ Valor do peso:', peso);
            
            if (!peso || peso <= 0) {
                alert('‚ö†Ô∏è Por favor, insira um peso v√°lido!');
                return;
            }
            
            if (!usuarioAtual || !usuarioAtual.id) {
                alert('‚ùå Erro: Usu√°rio n√£o identificado!');
                return;
            }
            
            try {
                console.log('Registrando peso:', peso, 'para usu√°rio:', usuarioAtual.id);
                
                const response = await fetch(`${API_URL}/registros-diarios`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        usuarioId: usuarioAtual.id,
                        data: new Date().toISOString().split('T')[0],
                        peso: peso
                    })
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const registro = await response.json();
                    console.log('Registro criado:', registro);
                    
                    // Limpar campo
                    document.getElementById('novoPeso').value = '';
                    
                    // Recarregar usu√°rio para pegar os dados atualizados
                    const userResponse = await fetch(`${API_URL}/usuarios/${usuarioAtual.id}`);
                    if (userResponse.ok) {
                        usuarioAtual = await userResponse.json();
                        console.log('Usu√°rio atualizado:', usuarioAtual);
                        
                        // Atualizar displays de peso
                        document.getElementById('pesoAtualDisplay').textContent = usuarioAtual.pesoAtual.toFixed(1) + ' kg';
                        document.getElementById('imcValue').textContent = usuarioAtual.imc ? usuarioAtual.imc.toFixed(1) : '--';
                        
                        // Atualizar barra de progresso
                        await atualizarBarraProgresso();
                        
                        // Atualizar recompensas (XP, pontos, n√≠vel)
                        atualizarRecompensasInterface();
                        
                        // Atualizar visualiza√ß√£o corporal
                        atualizarVisualizacaoCorporal();
                        
                        // Recarregar hist√≥rico
                        await carregarHistoricoPeso();
                        
                        alert('‚úÖ Peso registrado com sucesso!');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('Erro ao registrar:', errorText);
                    alert('‚ùå Erro ao registrar peso: ' + errorText);
                }
            } catch (error) {
                console.error('Erro ao registrar peso:', error);
                alert('‚ùå Erro ao registrar peso: ' + error.message);
            }
        }
        
        // Fun√ß√£o para atualizar apenas a barra de progresso
        function atualizarRecompensasInterface() {
            if (usuarioAtual && usuarioAtual.sistemaRecompensas) {
                const recompensas = usuarioAtual.sistemaRecompensas;
                
                // Atualizar Pontos/XP
                document.getElementById('pontosTotal').textContent = recompensas.pontos || 0;
                document.getElementById('xpAtual').textContent = recompensas.experiencia || 0;
                
                // Atualizar N√≠vel
                document.getElementById('nivelAtual').textContent = recompensas.nivel || 1;
                document.getElementById('nivelTitulo').textContent = obterTituloNivel(recompensas.nivel || 1);
                
                // Atualizar Barra de XP
                const xpProximoNivel = Math.pow((recompensas.nivel || 1), 2) * 100;
                const xpNivelAtual = Math.pow((recompensas.nivel || 1) - 1, 2) * 100;
                const xpProgresso = (recompensas.experiencia || 0) - xpNivelAtual;
                const xpNecessario = xpProximoNivel - xpNivelAtual;
                const porcentagemXP = Math.min(100, (xpProgresso / xpNecessario) * 100);
                
                document.getElementById('xpBar').style.width = porcentagemXP + '%';
                document.getElementById('xpBar').textContent = Math.round(porcentagemXP) + '%';
                document.getElementById('xpProximoNivel').textContent = xpProximoNivel;
                
                // Atualizar Streak
                document.getElementById('diasConsecutivos').textContent = recompensas.diasConsecutivos || 0;
                document.getElementById('recordeStreak').textContent = recompensas.recordeStreak || 0;
                
                // Atualizar Multiplicador
                const multiplicador = obterMultiplicador(recompensas.diasConsecutivos || 0);
                document.getElementById('multiplicadorAtual').textContent = multiplicador.toFixed(1) + 'x';
                
                // Atualizar Conquistas
                atualizarConquistas(recompensas.conquistas || []);
            }
        }

        async function atualizarBarraProgresso() {
            try {
                // Buscar usu√°rio atualizado do servidor
                const userResponse = await fetch(`${API_URL}/usuarios/${usuarioAtual.id}`);
                if (userResponse.ok) {
                    usuarioAtual = await userResponse.json();
                }
                
                // Usar peso inicial do usu√°rio (campo fixo)
                const pesoInicial = usuarioAtual.pesoInicial || usuarioAtual.pesoAtual;
                
                // Atualizar display de peso inicial
                document.getElementById('pesoInicialDisplay').textContent = pesoInicial.toFixed(1) + ' kg';
                
                // Calcular e atualizar progresso
                if (usuarioAtual.pesoMeta && usuarioAtual.pesoAtual && pesoInicial) {
                    const diferencaTotal = Math.abs(pesoInicial - usuarioAtual.pesoMeta);
                    const diferencaAtual = Math.abs(pesoInicial - usuarioAtual.pesoAtual);
                    const porcentagem = diferencaTotal > 0 ? (diferencaAtual / diferencaTotal) * 100 : 0;
                    const progressoFinal = Math.min(100, Math.max(0, porcentagem));
                    
                    document.getElementById('progressoPeso').style.width = progressoFinal + '%';
                    document.getElementById('progressoPeso').textContent = progressoFinal.toFixed(1) + '%';
                    document.getElementById('progressoPercentual').textContent = progressoFinal.toFixed(1) + '%';
                    
                    console.log('Progresso atualizado:', {
                        pesoInicial,
                        pesoAtual: usuarioAtual.pesoAtual,
                        pesoMeta: usuarioAtual.pesoMeta,
                        progressoFinal
                    });
                }
            } catch (error) {
                console.error('Erro ao atualizar barra de progresso:', error);
            }
        }

        // Fazer Logout
        function fazerLogout() {
            usuarioAtual = null;
            localStorage.removeItem('usuarioId');
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('authPage').style.display = 'flex';
            document.getElementById('loginForm').reset();
        }

        // Fun√ß√µes de Mensagem
        function showMessage(elementId, message, type) {
            const msgElement = document.getElementById(elementId);
            msgElement.className = `message ${type}`;
            msgElement.textContent = message;
            msgElement.style.display = 'block';
        }

        function hideMessage(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        // Desenhar visualiza√ß√£o corporal realista
        function desenharCorpoHumano(percentualGordura, genero) {
            const canvas = document.getElementById('bodyCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const isMasculino = genero === 'MASCULINO';
            
            // Calcular propor√ß√µes baseadas no percentual de gordura de forma mais realista
            let props = calcularProporcoesRealistas(percentualGordura, isMasculino);
            
            // Configura√ß√£o de desenho
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Cor base do corpo
            const corPele = '#e8d4c0';
            const corContorno = '#b89968';
            
            // Cabe√ßa com formato mais realista
            ctx.fillStyle = corPele;
            ctx.strokeStyle = corContorno;
            ctx.beginPath();
            ctx.ellipse(centerX, 35, props.cabecaLargura, props.cabecaAltura, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Pesco√ßo
            ctx.beginPath();
            ctx.moveTo(centerX - props.pescocoLargura / 2, 55);
            ctx.lineTo(centerX - props.pescocoLargura / 2, 70);
            ctx.lineTo(centerX + props.pescocoLargura / 2, 70);
            ctx.lineTo(centerX + props.pescocoLargura / 2, 55);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Ombros e parte superior do torso (com curvas)
            ctx.beginPath();
            ctx.moveTo(centerX - props.ombrosLargura / 2, 70);
            ctx.quadraticCurveTo(centerX - props.ombrosLargura / 2, 80, centerX - props.peitoLargura / 2, 95);
            ctx.lineTo(centerX - props.peitoLargura / 2, 95);
            ctx.lineTo(centerX + props.peitoLargura / 2, 95);
            ctx.quadraticCurveTo(centerX + props.ombrosLargura / 2, 80, centerX + props.ombrosLargura / 2, 70);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Torso m√©dio (peito/seios at√© cintura) - com curvas realistas
            ctx.beginPath();
            ctx.moveTo(centerX - props.peitoLargura / 2, 95);
            ctx.bezierCurveTo(
                centerX - props.peitoLargura / 2 - props.gorduraAbdominal, 120,
                centerX - props.cintura / 2 - props.gorduraAbdominal, 150,
                centerX - props.cintura / 2, 175
            );
            ctx.lineTo(centerX + props.cintura / 2, 175);
            ctx.bezierCurveTo(
                centerX + props.cintura / 2 + props.gorduraAbdominal, 150,
                centerX + props.peitoLargura / 2 + props.gorduraAbdominal, 120,
                centerX + props.peitoLargura / 2, 95
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Quadril (com formato mais realista)
            ctx.beginPath();
            ctx.moveTo(centerX - props.cintura / 2, 175);
            ctx.bezierCurveTo(
                centerX - props.quadrilLargura / 2, 180,
                centerX - props.quadrilLargura / 2, 210,
                centerX - props.quadrilBase / 2, 230
            );
            ctx.lineTo(centerX + props.quadrilBase / 2, 230);
            ctx.bezierCurveTo(
                centerX + props.quadrilLargura / 2, 210,
                centerX + props.quadrilLargura / 2, 180,
                centerX + props.cintura / 2, 175
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Bra√ßo esquerdo (parte superior)
            ctx.beginPath();
            const bracoEsqX = centerX - props.ombrosLargura / 2;
            ctx.moveTo(bracoEsqX, 75);
            ctx.lineTo(bracoEsqX - props.bracoLargura, 75);
            ctx.bezierCurveTo(
                bracoEsqX - props.bracoLargura - 2, 100,
                bracoEsqX - props.antebracoLargura - 2, 130,
                bracoEsqX - props.antebracoLargura, 160
            );
            ctx.lineTo(bracoEsqX - props.antebracoLargura + 5, 160);
            ctx.bezierCurveTo(
                bracoEsqX + 3, 130,
                bracoEsqX + 3, 100,
                bracoEsqX, 75
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Bra√ßo direito (parte superior)
            ctx.beginPath();
            const bracoDirX = centerX + props.ombrosLargura / 2;
            ctx.moveTo(bracoDirX, 75);
            ctx.lineTo(bracoDirX + props.bracoLargura, 75);
            ctx.bezierCurveTo(
                bracoDirX + props.bracoLargura + 2, 100,
                bracoDirX + props.antebracoLargura + 2, 130,
                bracoDirX + props.antebracoLargura, 160
            );
            ctx.lineTo(bracoDirX + props.antebracoLargura - 5, 160);
            ctx.bezierCurveTo(
                bracoDirX - 3, 130,
                bracoDirX - 3, 100,
                bracoDirX, 75
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Perna esquerda (com formato anat√¥mico)
            ctx.beginPath();
            const pernaEsqX = centerX - props.quadrilBase / 2 + 8;
            ctx.moveTo(pernaEsqX, 230);
            ctx.bezierCurveTo(
                pernaEsqX - 3, 260,
                pernaEsqX - props.coxaLargura / 2, 290,
                pernaEsqX - props.panturrilhaLargura / 2, 330
            );
            ctx.lineTo(pernaEsqX - props.tornozeloLargura / 2, 380);
            ctx.lineTo(pernaEsqX + props.tornozeloLargura / 2, 380);
            ctx.lineTo(pernaEsqX + props.panturrilhaLargura / 2, 330);
            ctx.bezierCurveTo(
                pernaEsqX + props.coxaLargura / 2, 290,
                pernaEsqX + 3, 260,
                pernaEsqX, 230
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Perna direita (com formato anat√¥mico)
            ctx.beginPath();
            const pernaDirX = centerX + props.quadrilBase / 2 - 8;
            ctx.moveTo(pernaDirX, 230);
            ctx.bezierCurveTo(
                pernaDirX + 3, 260,
                pernaDirX + props.coxaLargura / 2, 290,
                pernaDirX + props.panturrilhaLargura / 2, 330
            );
            ctx.lineTo(pernaDirX + props.tornozeloLargura / 2, 380);
            ctx.lineTo(pernaDirX - props.tornozeloLargura / 2, 380);
            ctx.lineTo(pernaDirX - props.panturrilhaLargura / 2, 330);
            ctx.bezierCurveTo(
                pernaDirX - props.coxaLargura / 2, 290,
                pernaDirX - 3, 260,
                pernaDirX, 230
            );
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Adicionar defini√ß√£o muscular para baixos percentuais
            if (percentualGordura < 15) {
                ctx.strokeStyle = 'rgba(139, 90, 43, 0.3)';
                ctx.lineWidth = 1;
                
                // Linhas de defini√ß√£o abdominal
                if (percentualGordura < 12) {
                    ctx.beginPath();
                    ctx.moveTo(centerX, 110);
                    ctx.lineTo(centerX, 170);
                    ctx.stroke();
                    
                    // Linhas horizontais dos abs
                    for (let i = 0; i < 3; i++) {
                        const y = 120 + (i * 20);
                        ctx.beginPath();
                        ctx.moveTo(centerX - 15, y);
                        ctx.lineTo(centerX + 15, y);
                        ctx.stroke();
                    }
                }
            }
        }
        
        // Calcular propor√ß√µes realistas baseadas no percentual de gordura
        function calcularProporcoesRealistas(percentualGordura, isMasculino) {
            let props = {};
            
            if (isMasculino) {
                // Homem: quanto maior a gordura, menos defini√ß√£o e mais volume
                if (percentualGordura < 8) {
                    // Atleta profissional - muito definido
                    props = {
                        cabecaLargura: 18, cabecaAltura: 22,
                        pescocoLargura: 12,
                        ombrosLargura: 65, peitoLargura: 55,
                        cintura: 42, gorduraAbdominal: 0,
                        quadrilLargura: 50, quadrilBase: 45,
                        bracoLargura: 15, antebracoLargura: 12,
                        coxaLargura: 22, panturrilhaLargura: 16, tornozeloLargura: 10
                    };
                } else if (percentualGordura < 12) {
                    // Fitness - definido
                    props = {
                        cabecaLargura: 18, cabecaAltura: 22,
                        pescocoLargura: 13,
                        ombrosLargura: 68, peitoLargura: 58,
                        cintura: 48, gorduraAbdominal: 2,
                        quadrilLargura: 52, quadrilBase: 48,
                        bracoLargura: 16, antebracoLargura: 13,
                        coxaLargura: 24, panturrilhaLargura: 17, tornozeloLargura: 10
                    };
                } else if (percentualGordura < 18) {
                    // M√©dia - leve gordura vis√≠vel
                    props = {
                        cabecaLargura: 19, cabecaAltura: 23,
                        pescocoLargura: 14,
                        ombrosLargura: 70, peitoLargura: 62,
                        cintura: 58, gorduraAbdominal: 6,
                        quadrilLargura: 58, quadrilBase: 52,
                        bracoLargura: 18, antebracoLargura: 14,
                        coxaLargura: 27, panturrilhaLargura: 19, tornozeloLargura: 11
                    };
                } else if (percentualGordura < 25) {
                    // Acima da m√©dia - barriga vis√≠vel
                    props = {
                        cabecaLargura: 20, cabecaAltura: 24,
                        pescocoLargura: 16,
                        ombrosLargura: 72, peitoLargura: 68,
                        cintura: 68, gorduraAbdominal: 12,
                        quadrilLargura: 66, quadrilBase: 58,
                        bracoLargura: 21, antebracoLargura: 16,
                        coxaLargura: 32, panturrilhaLargura: 22, tornozeloLargura: 12
                    };
                } else {
                    // Obesidade - muito volume
                    props = {
                        cabecaLargura: 21, cabecaAltura: 25,
                        pescocoLargura: 18,
                        ombrosLargura: 75, peitoLargura: 75,
                        cintura: 78, gorduraAbdominal: 20,
                        quadrilLargura: 75, quadrilBase: 68,
                        bracoLargura: 26, antebracoLargura: 20,
                        coxaLargura: 38, panturrilhaLargura: 26, tornozeloLargura: 14
                    };
                }
            } else {
                // Mulher: formato mais curvil√≠neo, quadril mais largo
                if (percentualGordura < 18) {
                    // Atleta - muito definida
                    props = {
                        cabecaLargura: 17, cabecaAltura: 21,
                        pescocoLargura: 10,
                        ombrosLargura: 58, peitoLargura: 52,
                        cintura: 38, gorduraAbdominal: 0,
                        quadrilLargura: 62, quadrilBase: 55,
                        bracoLargura: 12, antebracoLargura: 10,
                        coxaLargura: 24, panturrilhaLargura: 16, tornozeloLargura: 9
                    };
                } else if (percentualGordura < 24) {
                    // Fitness - curvas definidas
                    props = {
                        cabecaLargura: 17, cabecaAltura: 21,
                        pescocoLargura: 11,
                        ombrosLargura: 60, peitoLargura: 55,
                        cintura: 44, gorduraAbdominal: 3,
                        quadrilLargura: 68, quadrilBase: 60,
                        bracoLargura: 14, antebracoLargura: 11,
                        coxaLargura: 27, panturrilhaLargura: 18, tornozeloLargura: 9
                    };
                } else if (percentualGordura < 31) {
                    // M√©dia - curvas naturais
                    props = {
                        cabecaLargura: 18, cabecaAltura: 22,
                        pescocoLargura: 12,
                        ombrosLargura: 62, peitoLargura: 60,
                        cintura: 52, gorduraAbdominal: 8,
                        quadrilLargura: 75, quadrilBase: 65,
                        bracoLargura: 17, antebracoLargura: 13,
                        coxaLargura: 32, panturrilhaLargura: 21, tornozeloLargura: 10
                    };
                } else {
                    // Acima da m√©dia - mais volume
                    props = {
                        cabecaLargura: 19, cabecaAltura: 23,
                        pescocoLargura: 14,
                        ombrosLargura: 65, peitoLargura: 68,
                        cintura: 62, gorduraAbdominal: 15,
                        quadrilLargura: 82, quadrilBase: 72,
                        bracoLargura: 22, antebracoLargura: 17,
                        coxaLargura: 38, panturrilhaLargura: 25, tornozeloLargura: 11
                    };
                }
            }
            
            return props;
        }
        
        // Obter categoria de gordura corporal
        function obterCategoriaGordura(percentualGordura, genero) {
            if (genero === 'MASCULINO') {
                if (percentualGordura < 6) return 'Essencial (Atleta)';
                if (percentualGordura < 14) return 'Atl√©tico';
                if (percentualGordura < 18) return 'Fitness';
                if (percentualGordura < 25) return 'M√©dia';
                return 'Acima da M√©dia';
            } else {
                if (percentualGordura < 14) return 'Essencial (Atleta)';
                if (percentualGordura < 21) return 'Atl√©tico';
                if (percentualGordura < 25) return 'Fitness';
                if (percentualGordura < 32) return 'M√©dia';
                return 'Acima da M√©dia';
            }
        }
        
        // Atualizar visualiza√ß√£o corporal
        function atualizarVisualizacaoCorporal() {
            if (!usuarioAtual || !usuarioAtual.percentualGordura) {
                document.getElementById('percentualGorduraDisplay').textContent = '--';
                document.getElementById('categoriaGordura').textContent = 'Dados insuficientes';
                return;
            }
            
            const percentual = usuarioAtual.percentualGordura;
            document.getElementById('percentualGorduraDisplay').textContent = percentual.toFixed(1) + '%';
            document.getElementById('categoriaGordura').textContent = obterCategoriaGordura(percentual, usuarioAtual.genero);
            
            desenharCorpoHumano(percentual, usuarioAtual.genero);
        }

        // Auto-login se houver usu√°rio salvo
        window.addEventListener('load', async () => {
            const usuarioId = localStorage.getItem('usuarioId');
            if (usuarioId) {
                try {
                    const response = await fetch(`${API_URL}/usuarios/${usuarioId}`);
                    if (response.ok) {
                        usuarioAtual = await response.json();
                        mostrarDashboard();
                    }
                } catch (error) {
                    console.error('Erro ao carregar usu√°rio:', error);
                }
            }
        });
    </script>
</body>
</html>
